<html
  xmlns="http://www.w3.org/1999/xhtml"
  xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal"
  xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  metal:use-macro="view/macro:page/main_only"
  i18n:domain="launchpad">
<body>

<metal:block fill-slot="head_epilogue">
  <style type="text/css">
    .subordinate {
      margin: 0.5em 0 0.5em 4em;
      max-width: 80%;
      margin-bottom: 1em;
    }
    table.subordinate tr.even {
      background-color: #eee;
    }
    /* These add up to 100%. */
    tr .channel-row-track {
      width: 35%;
    }
    tr .channel-row-risk {
      width: 25%;
    }
    tr .channel-row-branch {
      width: 35%;
    }
    tr .channel-row-delete {
      width: 5%;
    }
  </style>
</metal:block>

<div metal:fill-slot="main">
  <div metal:use-macro="context/@@launchpad_form/form">
    <metal:formbody fill-slot="widgets">
      <table class="form">
        <tal:widget define="widget nocall:view/widgets/owner">
          <metal:block use-macro="context/@@launchpad_form/widget_row" />
        </tal:widget>
        <tal:widget define="widget nocall:view/widgets/project">
          <metal:block use-macro="context/@@launchpad_form/widget_row" />
        </tal:widget>
        <tal:widget define="widget nocall:view/widgets/name">
          <metal:block use-macro="context/@@launchpad_form/widget_row" />
        </tal:widget>

        <tal:widget define="widget nocall:view/widgets/git_ref">
          <metal:block use-macro="context/@@launchpad_form/widget_row" />
        </tal:widget>

        <tal:widget define="widget nocall:view/widgets/build_path">
          <metal:block use-macro="context/@@launchpad_form/widget_row" />
        </tal:widget>

        <tal:widget define="widget nocall:view/widgets/auto_build">
          <metal:block use-macro="context/@@launchpad_form/widget_row" />
        </tal:widget>
        <tr>
          <td>
            <table class="subordinate">
              <tal:widget define="widget nocall:view/widgets/auto_build_channels">
                <metal:block use-macro="context/@@launchpad_form/widget_row" />
              </tal:widget>
            </table>
          </td>
        </tr>

        <tal:widget define="widget nocall:view/widgets/store_upload">
          <metal:block use-macro="context/@@launchpad_form/widget_row" />
        </tal:widget>
        <tr>
          <td>
            <table class="subordinate">
              <tal:widget define="widget nocall:view/widgets/store_name">
                <metal:block use-macro="context/@@launchpad_form/widget_row" />
              </tal:widget>
              <tal:widget define="widget nocall:view/widgets/store_channels">
                <metal:block use-macro="context/@@launchpad_form/widget_row" />
              </tal:widget>
            </table>
          </td>
        </tr>

        <tal:widget define="widget nocall:view/widgets/use_fetch_service">
          <metal:block use-macro="context/@@launchpad_form/widget_row" />
        </tal:widget>

        <div id="fetch-service-policy-container">
          <tal:widget define="widget nocall:view/widgets/fetch_service_policy">
            <metal:block use-macro="context/@@launchpad_form/widget_row" />
          </tal:widget>
        </div>
      </table>
    </metal:formbody>
  </div>

  <!-- Script to enable/disable the fetch_service_policy dropdown depending on whether the use_fetch_service flag is set -->
  <script type="text/javascript">
    LPJS.use('node', function(Y) {
      Y.on('domready', function () {
        var fs_checkbox = Y.one("input[name='field.use_fetch_service']");
        var fs_policy_select = Y.one("select[name='field.fetch_service_policy']");

        if (!fs_checkbox || !fs_policy_select) return;

        function toggleFetchPolicy() {
          if (fs_checkbox.get('checked')) {
            fs_policy_select.set('disabled', false);
          } else {
            fs_policy_select.set('disabled', true);
          }
        }

        toggleFetchPolicy(); // On page load
        fs_checkbox.on('change', toggleFetchPolicy);
      });
    });
  </script>
</div>

</body>
</html>
