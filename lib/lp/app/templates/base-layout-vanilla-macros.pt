<macros xmlns="http://www.w3.org/1999/xhtml" xmlns:tal="http://xml.zope.org/namespaces/tal"
  xmlns:metal="http://xml.zope.org/namespaces/metal" xmlns:i18n="http://xml.zope.org/namespaces/i18n"
  i18n:domain="launchpad" tal:omit-tag="">

  <metal:navigation define-macro="vf-navigation">
    <header id="navigation" class="p-navigation">
      <div class="p-navigation__row">
        <div class="p-navigation__banner">
          <div class="p-navigation__tagged-logo">
            <a class="p-navigation__link" href="/">
              <div class="p-navigation__logo-tag">
                <img class="p-navigation__logo-icon" src="/@@/launchpad-logomark-only.svg" alt="Logo">
              </div>
              <span class="p-navigation__logo-title">Launchpad</span>
            </a>
          </div>
          <a href="#navigation" class="p-navigation__toggle--open" title="menu">Menu</a>
          <a href="#navigation-closed" class="p-navigation__toggle--close" title="close menu">Close menu</a>
        </div>
        <nav class="p-navigation__nav" aria-label="Example sub navigation">
          <ul class="p-navigation__items">
            <!-- add navigation items here when needed -->
          </ul>

          <ul class="p-navigation__items">
            <li class="p-navigation__item--title">
              <metal:switch use-macro="context/@@+launchpad-debug-timeline-vanilla-macros/switch" />
            </li>
            <tal:login replace="structure context/@@login_status_vanilla" />
          </ul>
        </nav>
      </div>
      <script>
        function toggleDropdown(toggle, open) {
          var parentElement = toggle.parentNode;
          var dropdown = document.getElementById(toggle.getAttribute('aria-controls'));
          dropdown.setAttribute('aria-hidden', !open);

          if (open) {
            parentElement.classList.add('is-active');
          } else {
            parentElement.classList.remove('is-active');
          }
        }

        function closeAllDropdowns(toggles) {
          toggles.forEach(function (toggle) {
            toggleDropdown(toggle, false);
          });
        }

        function handleClickOutside(toggles, containerClass) {
          document.addEventListener('click', function (event) {
            var target = event.target;

            if (target.closest) {
              if (!target.closest(containerClass)) {
                closeAllDropdowns(toggles);
              }
            }
          });
        }

        function initNavDropdowns(containerClass) {
          var toggles = [].slice.call(document.querySelectorAll(containerClass + ' [aria-controls]'));

          handleClickOutside(toggles, containerClass);

          toggles.forEach(function (toggle) {
            toggle.addEventListener('click', function (e) {
              e.preventDefault();

              const shouldOpen = !toggle.parentNode.classList.contains('is-active');
              closeAllDropdowns(toggles);
              toggleDropdown(toggle, shouldOpen);
            });
          });
        }

        initNavDropdowns('.p-navigation__item--dropdown-toggle')
      </script>
    </header>
  </metal:navigation>



  <metal:notifications define-macro="notifications" tal:define="notifications notifications|request/notifications">
    <tal:comment replace="nothing">
      This macro expects the following variables:
      :notifications: An object implementing INotificationList.
    </tal:comment>
    <section class="row">
      <div class="p-notification--negative" tal:repeat="notification notifications/error">
        <div class="p-notification__content">
          <button class="p-notification__close">Close</button>
          <p class="p-notification__message" tal:content="structure notification/message">An error notification message
          </p>
        </div>
      </div>
      <div class="p-notification--caution" tal:repeat="notification notifications/warning">
        <div class="p-notification__content">
          <button class="p-notification__close">Close</button>
          <p class="p-notification__message" tal:content="structure notification/message">A warning notification message
          </p>
        </div>
      </div>
      <div class="p-notification--information" tal:repeat="notification notifications/info">
        <div class="p-notification__content">
          <button class="p-notification__close">Close</button>
          <p class="p-notification__message" tal:content="structure notification/message">An info notification message
          </p>
        </div>
      </div>
      <div class="p-notification--information" tal:repeat="notification notifications/debug">
        <div class="p-notification__content">
          <button class="p-notification__close">Close</button>
          <p class="p-notification__message" tal:content="structure notification/message">A debug notification message,
            only displayed for developers.</p>
        </div>
      </div>
      <script>
        /**
          Attaches event listener for hide notification on close button click.
          @param {HTMLElement} closeButton The notification close button element.
        */
        function setupCloseButton(closeButton) {
          closeButton.addEventListener('click', function (event) {
            const container = closeButton.closest('.p-notification__content').parentElement;
            if (container) {
              container.style.display = 'none';
            }
            // Remove the notification_type query parameter from the URL after close is pressed, without reloading.
            const url = new URL(window.location);
            if (url.searchParams.has('notification_type') ||
              url.searchParams.has('notification_message')) {
              url.searchParams.delete('notification_type');
              url.searchParams.delete('notification_message');
              window.history.replaceState({}, '', url);
            }
          });
        }
        document.querySelectorAll('.p-notification__close').forEach(setupCloseButton);
      </script>
    </section>
  </metal:notifications>
</macros>